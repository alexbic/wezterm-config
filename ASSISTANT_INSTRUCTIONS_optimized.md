# 🤖 ИНСТРУКЦИИ ДЛЯ AI АССИСТЕНТА - WEZTERM CONFIG PROJECT

## 👤 КОНТЕКСТ ОПЕРАТОРА
- **Имя оператора:** Александр
- **Язык общения:** Русский
- **Платформа:** macOS
- **Уровень экспертизы:** Средний (WezTerm)

## ⚙️ НАСТРОЙКИ ДИАЛОГА
- **Тип ассистента:** Claude
- **Реальный лимит:** ~35 сообщений (НЕ 100!)
- **Порог подготовки к завершению:** 28+ сообщений (~80%)
- **Формат commit:** Подробный

## 📊 АВТОМАТИЧЕСКИЙ КОНТРОЛЬ ДИАЛОГА
**ОБЯЗАТЕЛЬНО:**
- Вести счетчик: #X/35 с первого сообщения
- При 15 сообщениях: первое предупреждение (45%)
- При 28 сообщениях: подготовка к завершению (80%)
- Обращаться по имени: "Александр"
- Адаптировать под средний уровень WezTerm
- Команды для macOS

## 🚨 КРИТИЧЕСКИЕ ПРАВИЛА (ПРИОРИТЕТ #1)

### 🛡️ ЗОЛОТОЕ ПРАВИЛО ВЫДАЧИ КОМАНД
- ВСЕГДА выдавать по ОДНОЙ команде
- ЖДАТЬ результата от пользователя
- АНАЛИЗИРОВАТЬ результат перед следующей
- НЕ выдавать блоки без ожидания
- НЕ переходить к следующему этапу без подтверждения

### ⚡ ГРУППИРОВКА КОМАНД С КОММЕНТАРИЯМИ
Обязательный паттерн:
echo "=== ОПИСАНИЕ ===" && команда1 && echo "этап" && команда2 && echo "SUCCESS"

### 🔍 ДИАГНОСТИКА ПЕРЕД ДЕЙСТВИЕМ
ВСЕГДА перед sed/исправлениями:
- RESULT=$(grep -n "проблема" файл) && echo "$RESULT"
- Анализировать контекст и причину
- Только потом предлагать исправления

### ⚙️ СИСТЕМЫ ЛОКАЛИЗАЦИИ WezTerm
КРИТИЧНЫЕ ПРАВИЛА:
- environment.locale.t.key - статическая таблица данных
- ЗАПРЕЩЕНО: environment.locale.t("key") или environment.locale.t(key)
- При ошибках "attempt to call a table value" - ищи старые вызовы функций
- Проверка: RESULT=$(grep -r "environment\.locale\.t(" .) && echo "$RESULT"

## 🚨 РЕШЕНИЕ ПРОБЛЕМЫ cmdand dquote> (ПОЛНОЕ)

### ОБНАРУЖЕННЫЕ ПРИЧИНЫ
1. Сложные regex с экранированием в grep внутри && цепочек
2. Множественное экранирование в echo команды
3. Markdown блоки с тройными backticks в heredoc
4. Специальные символы в git commit сообщениях

### РАБОЧИЕ РЕШЕНИЯ
1. ИЗОЛЯЦИЯ GREP: RESULT=$(grep pattern file) && echo "$RESULT"
2. ПРОСТЫЕ ECHO: избегать сложного экранирования
3. HEREDOC БЕЗ MARKDOWN: не использовать тройные backticks внутри heredoc
4. ПРОСТЫЕ GIT COMMIT: без спецсимволов в многострочных сообщениях

### БЕЗОПАСНЫЕ ПАТТЕРНЫ
РАБОТАЕТ: RESULT=$(grep -rn "pattern" .)
РАБОТАЕТ: cat > file << 'EOF' простой текст EOF
РАБОТАЕТ: git add . && git commit -m "Простое описание"

### ОБНОВЛЕННОЕ ПРАВИЛО
- ВСЕГДА изолировать grep команды в переменные
- НИКОГДА не использовать сложное экранирование в echo
- ИЗБЕГАТЬ markdown форматирования в heredoc
- ИСПОЛЬЗОВАТЬ простые git commit сообщения

## 🔧 ФИНАЛЬНЫЕ ПРИНЦИПЫ
- Простота превыше всего
- Одна команда - один результат
- Изоляция сложных операций
- Проверенные паттерны

---
Создано для Александра - WezTerm локализация
Последнее обновление: 2025-06-04
ФИНАЛЬНАЯ ВЕРСИЯ с решением cmdand dquote

## 🚨 ПРАВИЛО: MARKDOWN В HEREDOC (КРИТИЧНО)

### ПРОБЛЕМА
При создании файлов с markdown форматированием через heredoc возникает поломка когда внутри текста есть тройные backticks или другие markdown элементы

### ЧТО ЛОМАЕТ HEREDOC
- Тройные backticks внутри heredoc (``` внутри << 'EOF')
- Символы # в начале строк (воспринимаются как markdown заголовки)
- Звездочки ** ** (markdown bold)
- Квадратные скобки [текст] внутри heredoc

### РАБОЧИЕ РЕШЕНИЯ
1. ЗАМЕНА ТРОЙНЫХ BACKTICKS: использовать слово "код" вместо ```
2. ЭКРАНИРОВАНИЕ СИМВОЛОВ: избегать # ** [] в начале строк
3. ПРОСТОЙ ТЕКСТ: писать обычным текстом без markdown внутри heredoc
4. АЛЬТЕРНАТИВНЫЕ РАЗДЕЛИТЕЛИ: использовать уникальные разделители вместо EOF

### ПРИМЕНЕНО В ИСПРАВЛЕНИИ
- Убрал тройные backticks заменил на "РАБОТАЕТ:"
- Упростил markdown заголовки
- Удалил сложное форматирование
- Использовал простой текст вместо markdown блоков

### БЕЗОПАСНЫЕ ПАТТЕРНЫ ДЛЯ MARKDOWN В HEREDOC
РАБОТАЕТ: cat > file.md << 'SIMPLE' обычный текст без спецсимволов SIMPLE
РАБОТАЕТ: echo "## Заголовок" > file.md && echo "текст" >> file.md
НЕ РАБОТАЕТ: cat > file.md << 'EOF' текст с ``` и # и ** EOF

### ПРАВИЛО MARKDOWN В HEREDOC
ВСЕГДА использовать КАВЫЧКИ вокруг разделителя:
- cat > file.md << 'EOF' (literal text, безопасно)  
- cat > file.md << "EOF" (literal text, безопасно)
- cat > file.md << EOF (ОПАСНО - интерпретирует спецсимволы)

### ПРОВЕРЕННОЕ РЕШЕНИЕ
Все наши markdown файлы создавать через: << 'DELIMITER'

